(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[654],{30285:(e,t,r)=>{"use strict";r.d(t,{$:()=>d,r:()=>l});var a=r(95155),s=r(12115),i=r(66634),n=r(74466),o=r(59434);let l=(0,n.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=s.forwardRef((e,t)=>{let{className:r,variant:s,size:n,asChild:d=!1,...c}=e,u=d?i.DX:"button";return(0,a.jsx)(u,{className:(0,o.cn)(l({variant:s,size:n,className:r})),ref:t,...c})});d.displayName="Button"},38606:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>A});var a=r(95155),s=r(12115),i=r(35695),n=r(98030),o=r(63920),l=r(94815),d=r(87374),c=r(9131),u=r(86566),f=r(36931),m=r(50172),p=r(11133),h=r(10518),x=r(25318),g=r(66695),v=r(59434),y=r(56104),j=r(81115),w=r(43454),b=r(34477);let N=(0,b.createServerReference)("70a64c0a7351ee07c21d7d4f2c06cea6720abf5ac4",b.callServer,void 0,b.findSourceMapURL,"updateOrderStatusAndNotify");var O=r(87481),S=r(30285);function A(){let{user:e,loading:t}=(0,n.A)(),r=(0,i.useRouter)(),{toast:b}=(0,O.dj)(),[A,E]=(0,s.useState)([]),[_,T]=(0,s.useState)({}),[I,R]=(0,s.useState)(!0),[C,D]=(0,s.useState)(null),[k,F]=(0,s.useState)(!1),[P,K]=(0,s.useState)(null);(0,s.useEffect)(()=>{F(!0)},[]);let U=(null==e?void 0:e.email)==="admin@example.com";(0,s.useEffect)(()=>{t||e||r.push("/login")},[e,t,r]),(0,s.useEffect)(()=>{if(t||!e)return;R(!0);let r=U?(0,j.KR)(y.OO,"notifications"):(0,j.KR)(y.OO,"user-notifications/".concat(e.uid)),a=(0,j.Zy)(r,e=>{if(e.exists()){let t=e.val();E(Object.keys(t).map(e=>({id:e,...t[e]})).sort((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime()))}else E([]);R(!1)},e=>{console.error("Failed to fetch notifications:",e),D("An error occurred while fetching notifications."),R(!1)});return()=>a()},[e,t,U]),(0,s.useEffect)(()=>{if(!U||0===A.length)return;let e=[...new Set(A.map(e=>e.orderId))],t=(0,j.KR)(y.OO,"orders");(0,j.Jt)((0,j.P)(t)).then(t=>{if(t.exists()){let r=t.val();T(e.reduce((e,t)=>(r[t]&&(e[t]={...r[t],id:t}),e),{}))}})},[A,U]);let M=async(t,r)=>{if(!e||!U)return;let a=_[t.orderId];if(!a)return void b({variant:"destructive",title:"Error",description:"Could not find the associated order."});K(t.id);let s=await e.getIdToken(),i=await N(a,r,s);if(i.success){b({title:"Order Updated",description:"Order has been ".concat("Shipped"===r?"accepted":"rejected",".")});let e=(0,j.KR)(y.OO,"notifications/".concat(t.id));await (0,j.yo)(e,{read:!0})}else b({variant:"destructive",title:"Update Failed",description:i.error});K(null)};if(t||I)return(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[calc(100vh-200px)]",children:(0,a.jsx)(m.A,{className:"h-8 w-8 animate-spin text-primary"})});let B=U?"Admin Notifications":"My Notifications",Z=U?"A log of important store events. New orders can be managed here.":"Updates about your orders and store news.";return(0,a.jsx)("div",{className:"p-4 sm:p-6 lg:p-8",children:(0,a.jsxs)("div",{className:"max-w-3xl mx-auto space-y-8",children:[(0,a.jsxs)("div",{className:"text-left",children:[(0,a.jsx)("h1",{className:"text-3xl sm:text-4xl font-bold tracking-tighter font-headline",children:B}),(0,a.jsx)("p",{className:"text-muted-foreground mt-2",children:Z})]}),C&&(0,a.jsxs)(g.Zp,{className:"border-destructive",children:[(0,a.jsx)(g.aR,{children:(0,a.jsxs)(g.ZB,{className:"flex items-center gap-2 text-destructive",children:[(0,a.jsx)(p.A,{className:"h-6 w-6"}),"Failed to load notifications"]})}),(0,a.jsx)(g.Wu,{children:(0,a.jsx)("p",{className:"text-destructive",children:C})})]}),(0,a.jsxs)(g.Zp,{children:[(0,a.jsxs)(g.aR,{children:[(0,a.jsx)(g.ZB,{children:"All Notifications"}),(0,a.jsx)(g.BT,{children:"A complete log of your notifications."})]}),(0,a.jsxs)(g.Wu,{className:"space-y-4",children:[0===A.length&&!C&&(0,a.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"You have no new notifications."}),A.map(e=>{let t=(e=>{switch(e){case"order_cancellation":return o.A;case"order_return":return l.A;case"new_order":return d.A;case"order_accepted":return c.A;case"order_rejected":return u.A;default:return f.A}})(e.type),r=(e=>{switch(e){case"order_cancellation":case"order_rejected":return"text-destructive";case"order_return":return"text-yellow-500";case"new_order":default:return"text-primary";case"order_accepted":return"text-green-500"}})(e.type),s=P===e.id,i=_[e.orderId],n=(null==i?void 0:i.status)==="Pending";return(0,a.jsxs)("div",{className:"flex items-start gap-4 p-4 rounded-lg bg-secondary/50",children:[(0,a.jsx)(t,{className:(0,v.cn)("h-6 w-6 mt-1 flex-shrink-0",r)}),(0,a.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:e.message}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:k?(0,w.m)(new Date(e.timestamp),{addSuffix:!0}):"..."}),U&&"new_order"===e.type&&!e.read&&n&&(0,a.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,a.jsxs)(S.$,{size:"sm",onClick:()=>M(e,"Shipped"),disabled:s,children:[s?(0,a.jsx)(m.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,a.jsx)(h.A,{className:"mr-2 h-4 w-4"}),"Accept"]}),(0,a.jsxs)(S.$,{size:"sm",variant:"destructive",onClick:()=>M(e,"Cancelled"),disabled:s,children:[s?(0,a.jsx)(m.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,a.jsx)(x.A,{className:"mr-2 h-4 w-4"}),"Reject"]})]})]})]},e.id)})]})]})]})})}},42271:(e,t,r)=>{Promise.resolve().then(r.bind(r,38606))},56104:(e,t,r)=>{"use strict";let a;r.d(t,{IG:()=>m,OO:()=>p,j2:()=>f});var s=r(23915),i=r(93004),n=r(90858),o=r(81115),l=r(49509);let d={apiKey:"AIzaSyCTdO0dfAN6jOW1tj-AQM4vSP7o6LVkdUg",authDomain:"acoof-8e92d.firebaseapp.com",projectId:"acoof-8e92d",storageBucket:"acoof-8e92d.firebasestorage.app",messagingSenderId:"791754268594",appId:"1:791754268594:web:51afb7e216efd2c44b8eab",databaseURL:"https://acoof-8e92d-default-rtdb.firebaseio.com"},c=l.env.FIREBASE_CONFIG?JSON.parse(l.env.FIREBASE_CONFIG):null;a=d.apiKey?d:c;let u=null,f=null,m=null,p=null;if(a&&a.apiKey)try{u=(0,s.Dk)().length?(0,s.Sx)():(0,s.Wp)(a),f=(0,i.xI)(u),m=(0,n.c7)(u),p=(0,o.C3)(u)}catch(e){console.error("Failed to initialize Firebase client SDK.",e)}else console.warn("Firebase configuration is missing or incomplete. Firebase client-side features will be disabled. If you are running locally, please create a .env.local file with your Firebase project's NEXT_PUBLIC_ credentials.")},59434:(e,t,r)=>{"use strict";r.d(t,{cn:()=>i});var a=r(52596),s=r(39688);function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.QP)((0,a.$)(t))}},66695:(e,t,r)=>{"use strict";r.d(t,{BT:()=>d,Wu:()=>c,ZB:()=>l,Zp:()=>n,aR:()=>o,wL:()=>u});var a=r(95155),s=r(12115),i=r(59434);let n=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...s})});n.displayName="Card";let o=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",r),...s})});o.displayName="CardHeader";let l=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",r),...s})});l.displayName="CardTitle";let d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",r),...s})});d.displayName="CardDescription";let c=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("p-6 pt-0",r),...s})});c.displayName="CardContent";let u=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("flex items-center p-6 pt-0",r),...s})});u.displayName="CardFooter"},87481:(e,t,r)=>{"use strict";r.d(t,{dj:()=>u});var a=r(12115);let s=0,i=new Map,n=e=>{if(i.has(e))return;let t=setTimeout(()=>{i.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);i.set(e,t)},o=[],l={toasts:[]};function d(e){l=((e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:r}=t;return r?n(r):e.toasts.forEach(e=>{n(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===r||void 0===r?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}})(l,e),o.forEach(e=>{e(l)})}function c(e){let{...t}=e,r=(s=(s+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>d({type:"DISMISS_TOAST",toastId:r});return d({type:"ADD_TOAST",toast:{...t,id:r,open:!0,onOpenChange:e=>{e||a()}}}),{id:r,dismiss:a,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:r}})}}function u(){let[e,t]=a.useState(l);return a.useEffect(()=>(o.push(t),()=>{let e=o.indexOf(t);e>-1&&o.splice(e,1)}),[e]),{...e,toast:c,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},98030:(e,t,r)=>{"use strict";r.d(t,{A:()=>f,AuthProvider:()=>u});var a=r(95155),s=r(12115),i=r(93004),n=r(56104),o=r(35695),l=r(81115);let d=(0,s.createContext)(void 0),c=Error("Firebase is not configured. Please add your Firebase credentials to the .env file."),u=e=>{let{children:t}=e,[r,u]=(0,s.useState)(null),[f,m]=(0,s.useState)(!0),p=(0,o.useRouter)();(0,s.useEffect)(()=>{if(!n.j2)return void m(!1);let e=(0,i.hg)(n.j2,async e=>{if(e){if(!n.OO){u(e),m(!1);return}let t=(0,l.KR)(n.OO,"users/".concat(e.uid));try{let r=await (0,l.Jt)(t);if(r.exists()){let t=r.val();Object.assign(e,t)}else{let r={email:e.email,displayName:e.displayName};await (0,l.hZ)(t,r),Object.assign(e,r)}u(e)}catch(t){u(e)}}else u(null);m(!1)});return()=>e()},[]);let h=async(e,t)=>{if(!n.j2)throw c;return(0,i.x9)(n.j2,e,t)},x=async(e,t,r,a)=>{if(!n.j2||!n.OO)throw c;try{let s=await (0,i.eJ)(n.j2,e,t);if(s.user)try{let e="".concat(r," ").concat(a);await (0,i.r7)(s.user,{displayName:e});let t=(0,l.KR)(n.OO,"users/".concat(s.user.uid));await (0,l.hZ)(t,{email:s.user.email,displayName:e})}catch(e){console.error("Database error during sign up:",e)}return s}catch(e){throw e}},g=async e=>{let t=null===n.j2||void 0===n.j2?void 0:n.j2.currentUser;if(!n.j2||!t||!n.OO)throw Error("Firebase not configured or user not logged in.");try{let r=[];e.displayName&&e.displayName!==t.displayName&&r.push((0,i.r7)(t,{displayName:e.displayName})),e.email&&e.email!==t.email&&r.push((0,i.Ww)(t,e.email)),r.length>0&&await Promise.all(r);let a=(0,l.KR)(n.OO,"users/".concat(t.uid)),s={};e.displayName&&(s.displayName=e.displayName),e.email&&(s.email=e.email),void 0!==e.phone&&(s.phone=e.phone),void 0!==e.address&&(s.address=e.address),void 0!==e.city&&(s.city=e.city),void 0!==e.state&&(s.state=e.state),void 0!==e.pincode&&(s.pincode=e.pincode),Object.keys(s).length>0&&await (0,l.yo)(a,s),await t.reload();let o=n.j2.currentUser;if(o){let e=await (0,l.Jt)(a),t=e.exists()?e.val():{};Object.assign(o,t),u(o)}else u(null)}catch(e){var r;if("PERMISSION_DENIED"===e.code||(null==(r=e.message)?void 0:r.includes("permission_denied")))throw Error("Permission Denied: Please check your Firebase Realtime Database security rules to allow users to read/write their own profile data.");if("auth/requires-recent-login"===e.code)throw Error("This action is sensitive and requires recent authentication. Please log out and log back in to update your email.");throw e}},v=async()=>{if(n.j2)try{await (0,i.CI)(n.j2),p.push("/login")}catch(e){console.error("Error signing out",e)}},y=async()=>{let e=null===n.j2||void 0===n.j2?void 0:n.j2.currentUser;if(!n.j2||!e||!n.OO)throw Error("Firebase not configured or user not logged in.");try{let t=(0,l.KR)(n.OO,"users/".concat(e.uid));await (0,l.TF)(t),await (0,i.hG)(e),u(null),p.push("/")}catch(e){if(console.error("Error deleting account:",e),"auth/requires-recent-login"===e.code)throw Error("This action is sensitive and requires recent authentication. Please log out and log back in before deleting your account.");throw Error("An unexpected error occurred while deleting your account.")}};return(0,a.jsx)(d.Provider,{value:{user:r,loading:f,loginWithEmail:h,signupWithEmail:x,logout:v,updateUserProfile:g,deleteAccount:y},children:t})},f=()=>{let e=(0,s.useContext)(d);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}},e=>{e.O(0,[507,644,889,277,238,441,964,358],()=>e(e.s=42271)),_N_E=e.O()}]);