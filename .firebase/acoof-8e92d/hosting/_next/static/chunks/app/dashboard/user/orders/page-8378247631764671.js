(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[255],{4290:(e,s,t)=>{Promise.resolve().then(t.bind(t,92974))},26126:(e,s,t)=>{"use strict";t.d(s,{E:()=>l});var r=t(95155);t(12115);var a=t(74466),i=t(59434);let n=(0,a.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:s,variant:t,...a}=e;return(0,r.jsx)("div",{className:(0,i.cn)(n({variant:t}),s),...a})}},92974:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>_});var r=t(95155),a=t(12115),i=t(35695),n=t(98030),l=t(50172),d=t(87374),o=t(85081),c=t(8376),u=t(24371),h=t(15300),m=t(11133),x=t(66695),p=t(85127),f=t(26126),j=t(87481),v=t(56104),g=t(81115),y=t(30285),N=t(90010),w=t(54165),b=t(78082),O=t(59434);let D=b.Kq,E=b.bL,C=b.l9,R=a.forwardRef((e,s)=>{let{className:t,sideOffset:a=4,...i}=e;return(0,r.jsx)(b.UC,{ref:s,sideOffset:a,className:(0,O.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...i})});R.displayName=b.UC.displayName;var A=t(70774),P=t(85057),I=t(88539),k=t(66766),S=t(6874),F=t.n(S);function _(){let{user:e,loading:s}=(0,n.A)(),t=(0,i.useRouter)(),{toast:b}=(0,j.dj)(),[O,S]=(0,a.useState)([]),[_,T]=(0,a.useState)(!0),[q,U]=(0,a.useState)(null),[K,z]=(0,a.useState)(null),[Z,J]=(0,a.useState)(!1),[M,Y]=(0,a.useState)("");if((0,a.useEffect)(()=>{s||e||t.push("/login")},[e,s,t]),(0,a.useEffect)(()=>{async function s(){if(!(null==e?void 0:e.uid)||!v.OO)return void T(!1);T(!0),U(null);try{let s=(0,g.KR)(v.OO,"users/".concat(e.uid,"/orders")),t=await (0,g.Jt)(s);if(!t.exists()){S([]),T(!1);return}let r=Object.keys(t.val()).map(e=>{let s=(0,g.KR)(v.OO,"orders/".concat(e));return(0,g.Jt)(s)}),a=(await Promise.all(r)).map(e=>e.exists()?{...e.val(),id:e.key}:null).filter(e=>null!==e).sort((e,s)=>new Date(s.date).getTime()-new Date(e.date).getTime());S(a)}catch(t){var s;console.error("Failed to fetch user orders:",t);let e="An error occurred while fetching your orders.";("PERMISSION_DENIED"===t.code||(null==(s=t.message)?void 0:s.includes("permission_denied")))&&(e="Permission Denied: Could not fetch order data. This is a Firebase security rule issue. To fix, please go to your Firebase project's Realtime Database rules and ensure authenticated users can read their own data under '/users/[their-id]' and can read individual orders from '/orders/[order-id]'."),U(e)}T(!1)}e&&s()},[e]),s||_||!e)return(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,r.jsx)(l.A,{className:"h-8 w-8 animate-spin text-primary"})});let $=async()=>{if(!K||!v.OO||!e||!e.email)return;if(!M)return void b({variant:"destructive",title:"Reason Required",description:"Please provide a reason for the request."});J(!0);let s="Cancelled";try{let t=(0,g.KR)(v.OO,"orders/".concat(K.id));await (0,g.yo)(t,{status:s,cancellationReason:M});try{let s="Delivered"===K.status?"order_return":"order_cancellation",t=(0,g.VC)((0,g.KR)(v.OO,"notifications")),r=t.key;if(r){let a="User ".concat(e.email," ").concat("order_return"===s?"initiated a return for":"cancelled"," order #").concat(K.id.slice(-6).toUpperCase(),"."),i={id:r,type:s,message:a,timestamp:new Date().toISOString(),read:!1,orderId:K.id,userId:e.uid,userEmail:e.email};await (0,g.hZ)(t,i)}}catch(e){console.error("Non-critical: Failed to create cancellation notification:",e)}S(e=>e.map(e=>e.id===K.id?{...e,status:s,cancellationReason:M}:e)),b({title:"Delivered"===K.status?"Return Initiated":"Order Cancelled",description:"Delivered"===K.status?"Your return request has been submitted.":"Your order has been successfully cancelled."})}catch(e){if("PERMISSION_DENIED"!==e.code||(null===v.j2||void 0===v.j2?void 0:v.j2.currentUser)){var t;console.error("Failed to cancel order:",e);let s="An unexpected error occurred while cancelling the order.";("PERMISSION_DENIED"===e.code||(null==(t=e.message)?void 0:t.includes("permission_denied")))&&(s="Permission Denied: Could not update order status. Please check your Firebase Database security rules to ensure you can modify your own orders."),b({variant:"destructive",title:"Cancellation Failed",description:s})}else console.warn("Order cancellation permission denied, user has logged out.")}finally{J(!1),z(null),Y("")}};return(0,r.jsxs)("div",{className:"p-4 sm:p-6 lg:p-8",children:[(0,r.jsxs)("div",{className:"max-w-4xl mx-auto space-y-8",children:[(0,r.jsxs)("div",{className:"text-left",children:[(0,r.jsx)("h1",{className:"text-3xl sm:text-4xl font-bold tracking-tighter font-headline",children:"My Orders"}),(0,r.jsx)("p",{className:"text-muted-foreground mt-2",children:"Track your purchase history and order status. You can return delivered items or cancel pending orders within 7 days of purchase."})]}),q&&(0,r.jsxs)(x.Zp,{className:"border-destructive",children:[(0,r.jsx)(x.aR,{children:(0,r.jsxs)(x.ZB,{className:"flex items-center gap-2 text-destructive",children:[(0,r.jsx)(m.A,{className:"h-6 w-6"}),"Failed to fetch orders"]})}),(0,r.jsx)(x.Wu,{children:(0,r.jsx)("p",{className:"text-destructive",children:q})})]}),(0,r.jsx)(x.Zp,{children:(0,r.jsx)(x.Wu,{className:"p-0",children:!q&&O.length>0?(0,r.jsx)("div",{className:"divide-y",children:O.map(e=>(0,r.jsxs)("div",{className:"p-4 sm:p-6 flex items-center gap-4",children:[(0,r.jsx)("div",{className:"hidden sm:block",children:(e=>{switch(e){case"Pending":return(0,r.jsx)(d.A,{className:"h-5 w-5 text-yellow-500"});case"Shipped":return(0,r.jsx)(o.A,{className:"h-5 w-5 text-blue-500"});case"Delivered":return(0,r.jsx)(c.A,{className:"h-5 w-5 text-green-500"});case"Cancelled":return(0,r.jsx)(u.A,{className:"h-5 w-5 text-red-500"});default:return(0,r.jsx)(h.A,{className:"h-5 w-5 text-muted-foreground"})}})(e.status)}),(0,r.jsxs)("div",{className:"flex-1 grid grid-cols-2 sm:grid-cols-4 gap-4 items-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"text-sm font-semibold text-primary truncate max-w-24 sm:max-w-full",children:["#",e.id.slice(-8).toUpperCase()]}),(0,r.jsx)("div",{className:"text-xs text-muted-foreground",children:e.date})]}),(0,r.jsxs)("div",{className:"hidden sm:block font-medium",children:["₹",e.total.toFixed(2)]}),(0,r.jsx)("div",{className:"col-span-1 flex justify-end sm:justify-start",children:(0,r.jsx)(f.E,{variant:"Pending"===e.status?"destructive":"Shipped"===e.status?"default":"Delivered"===e.status?"secondary":"outline",className:"w-24 justify-center",children:e.status})}),(0,r.jsxs)(w.lG,{children:[(0,r.jsx)(w.zM,{asChild:!0,children:(0,r.jsx)(y.$,{variant:"outline",className:"w-full sm:w-auto justify-self-end",children:"View Details"})}),(0,r.jsxs)(w.Cf,{className:"sm:max-w-3xl",children:[(0,r.jsxs)(w.c7,{children:[(0,r.jsx)(w.L3,{children:"Order Details"}),(0,r.jsxs)(w.rr,{children:["Order ID: #",e.id.slice(-8).toUpperCase()," placed on ",e.date]})]}),(0,r.jsxs)("div",{className:"grid gap-6 py-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h4",{className:"font-semibold",children:"Shipping Address"}),(0,r.jsx)("address",{className:"text-sm text-muted-foreground not-italic whitespace-pre-wrap",children:e.shippingAddress})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-semibold mb-2",children:"Items"}),(0,r.jsxs)(p.XI,{children:[(0,r.jsx)(p.A0,{children:(0,r.jsxs)(p.Hj,{children:[(0,r.jsx)(p.nd,{className:"w-[80px] hidden sm:table-cell",children:"Image"}),(0,r.jsx)(p.nd,{children:"Product"}),(0,r.jsx)(p.nd,{className:"text-center",children:"Quantity"}),(0,r.jsx)(p.nd,{className:"text-right",children:"Price"})]})}),(0,r.jsx)(p.BF,{children:e.items.map((e,s)=>(0,r.jsxs)(p.Hj,{children:[(0,r.jsx)(p.nA,{className:"hidden sm:table-cell",children:(0,r.jsx)(F(),{href:"/products/".concat(e.productId),children:(0,r.jsx)(k.default,{src:e.imageUrl||"https://placehold.co/80x80.png",alt:e.productName,width:60,height:75,className:"rounded-md object-cover"})})}),(0,r.jsxs)(p.nA,{children:[(0,r.jsx)(F(),{href:"/products/".concat(e.productId),className:"font-medium hover:underline",children:e.productName}),(e.size||e.color)&&(0,r.jsxs)("div",{className:"text-xs text-muted-foreground",children:[e.size,e.size&&e.color&&" / ",e.color]})]}),(0,r.jsx)(p.nA,{className:"text-center",children:e.quantity}),(0,r.jsxs)(p.nA,{className:"text-right font-medium",children:["₹",(e.price*e.quantity).toFixed(2)]})]},s))})]})]})]}),(0,r.jsxs)(w.Es,{className:"sm:justify-between items-center pt-4 border-t",children:[(0,r.jsxs)("div",{className:"font-semibold text-lg",children:["Total: ₹",e.total.toFixed(2)]}),(()=>{let{cancellable:s,reason:t}=(e=>{if("Pending"!==e.status&&"Delivered"!==e.status)return{cancellable:!1,reason:"This order cannot be modified as its status is '".concat(e.status,"'.")};try{let s=new Date(e.date);if((0,A.c)(new Date,s)>7)return{cancellable:!1,reason:"This order is outside the 7-day return window."}}catch(s){return console.error("Could not parse order date:",e.date,s),{cancellable:!1,reason:"Could not determine order date."}}return{cancellable:!0,reason:""}})(e),a="Delivered"===e.status?"Return Order":"Cancel Order";return s?(0,r.jsxs)(y.$,{variant:"destructive",onClick:()=>z(e),children:[(0,r.jsx)(u.A,{className:"mr-2 h-4 w-4"}),a]}):(0,r.jsx)(D,{children:(0,r.jsxs)(E,{children:[(0,r.jsx)(C,{asChild:!0,children:(0,r.jsx)("span",{tabIndex:0,children:(0,r.jsxs)(y.$,{variant:"destructive",disabled:!0,className:"pointer-events-none",children:[(0,r.jsx)(u.A,{className:"mr-2 h-4 w-4"}),a]})})}),(0,r.jsx)(R,{children:(0,r.jsx)("p",{children:t})})]})})})()]})]})]})]})]},e.id))}):!q&&(0,r.jsx)("div",{className:"text-center p-12 text-muted-foreground",children:"You have not placed any orders yet."})})})]}),(0,r.jsx)(N.Lt,{open:!!K,onOpenChange:e=>{e||(z(null),Y(""))},children:(0,r.jsxs)(N.EO,{children:[(0,r.jsxs)(N.wd,{children:[(0,r.jsx)(N.r7,{children:"Are you absolutely sure?"}),(0,r.jsxs)(N.$v,{children:["This action cannot be undone. This will ",(null==K?void 0:K.status)==="Delivered"?"initiate a return for":"cancel"," your order ",(0,r.jsxs)("span",{className:"font-semibold",children:["#",null==K?void 0:K.id.slice(-6).toUpperCase()]}),"."]})]}),(0,r.jsxs)("div",{className:"py-2",children:[(0,r.jsxs)(P.J,{htmlFor:"cancellation-reason",className:"text-sm font-medium",children:["Reason for ",(null==K?void 0:K.status)==="Delivered"?"Return":"Cancellation"," (Required)"]}),(0,r.jsx)(I.T,{id:"cancellation-reason",placeholder:"Tell us why you're making this request...",value:M,onChange:e=>Y(e.target.value),className:"mt-2"})]}),(0,r.jsxs)(N.ck,{children:[(0,r.jsx)(N.Zr,{onClick:()=>{z(null),Y("")},disabled:Z,children:"Back"}),(0,r.jsxs)(N.Rx,{onClick:$,disabled:Z||!M,className:(0,y.r)({variant:"destructive"}),children:[Z?(0,r.jsx)(l.A,{className:"mr-2 h-4 w-4 animate-spin"}):null,Z?"Processing...":"Confirm ".concat((null==K?void 0:K.status)==="Delivered"?"Return":"Cancellation")]})]})]})})]})}},98030:(e,s,t)=>{"use strict";t.d(s,{A:()=>h,AuthProvider:()=>u});var r=t(95155),a=t(12115),i=t(93004),n=t(56104),l=t(35695),d=t(81115);let o=(0,a.createContext)(void 0),c=Error("Firebase is not configured. Please add your Firebase credentials to the .env file."),u=e=>{let{children:s}=e,[t,u]=(0,a.useState)(null),[h,m]=(0,a.useState)(!0),x=(0,l.useRouter)();(0,a.useEffect)(()=>{if(!n.j2)return void m(!1);let e=(0,i.hg)(n.j2,async e=>{if(e){if(!n.OO){u(e),m(!1);return}let s=(0,d.KR)(n.OO,"users/".concat(e.uid));try{let t=await (0,d.Jt)(s);if(t.exists()){let s=t.val();Object.assign(e,s)}else{let t={email:e.email,displayName:e.displayName};await (0,d.hZ)(s,t),Object.assign(e,t)}u(e)}catch(s){u(e)}}else u(null);m(!1)});return()=>e()},[]);let p=async(e,s)=>{if(!n.j2)throw c;return(0,i.x9)(n.j2,e,s)},f=async(e,s,t,r)=>{if(!n.j2||!n.OO)throw c;try{let a=await (0,i.eJ)(n.j2,e,s);if(a.user)try{let e="".concat(t," ").concat(r);await (0,i.r7)(a.user,{displayName:e});let s=(0,d.KR)(n.OO,"users/".concat(a.user.uid));await (0,d.hZ)(s,{email:a.user.email,displayName:e})}catch(e){console.error("Database error during sign up:",e)}return a}catch(e){throw e}},j=async e=>{let s=null===n.j2||void 0===n.j2?void 0:n.j2.currentUser;if(!n.j2||!s||!n.OO)throw Error("Firebase not configured or user not logged in.");try{let t=[];e.displayName&&e.displayName!==s.displayName&&t.push((0,i.r7)(s,{displayName:e.displayName})),e.email&&e.email!==s.email&&t.push((0,i.Ww)(s,e.email)),t.length>0&&await Promise.all(t);let r=(0,d.KR)(n.OO,"users/".concat(s.uid)),a={};e.displayName&&(a.displayName=e.displayName),e.email&&(a.email=e.email),void 0!==e.phone&&(a.phone=e.phone),void 0!==e.address&&(a.address=e.address),void 0!==e.city&&(a.city=e.city),void 0!==e.state&&(a.state=e.state),void 0!==e.pincode&&(a.pincode=e.pincode),Object.keys(a).length>0&&await (0,d.yo)(r,a),await s.reload();let l=n.j2.currentUser;if(l){let e=await (0,d.Jt)(r),s=e.exists()?e.val():{};Object.assign(l,s),u(l)}else u(null)}catch(e){var t;if("PERMISSION_DENIED"===e.code||(null==(t=e.message)?void 0:t.includes("permission_denied")))throw Error("Permission Denied: Please check your Firebase Realtime Database security rules to allow users to read/write their own profile data.");if("auth/requires-recent-login"===e.code)throw Error("This action is sensitive and requires recent authentication. Please log out and log back in to update your email.");throw e}},v=async()=>{if(n.j2)try{await (0,i.CI)(n.j2),x.push("/login")}catch(e){console.error("Error signing out",e)}},g=async()=>{let e=null===n.j2||void 0===n.j2?void 0:n.j2.currentUser;if(!n.j2||!e||!n.OO)throw Error("Firebase not configured or user not logged in.");try{let s=(0,d.KR)(n.OO,"users/".concat(e.uid));await (0,d.TF)(s),await (0,i.hG)(e),u(null),x.push("/")}catch(e){if(console.error("Error deleting account:",e),"auth/requires-recent-login"===e.code)throw Error("This action is sensitive and requires recent authentication. Please log out and log back in before deleting your account.");throw Error("An unexpected error occurred while deleting your account.")}};return(0,r.jsx)(o.Provider,{value:{user:t,loading:h,loginWithEmail:p,signupWithEmail:f,logout:v,updateUserProfile:j,deleteAccount:g},children:s})},h=()=>{let e=(0,a.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}},e=>{e.O(0,[507,644,889,277,506,821,874,418,657,947,441,964,358],()=>e(e.s=4290)),_N_E=e.O()}]);